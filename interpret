#!/usr/bin/env bash

# Check if a file argument is provided
if [ $# -eq 0 ]; then
	echo "Usage: ./interpret <script-name> or ./interpret -i <command>"
	exit 1
fi

case "$1" in
	-i)
		shift
		# Source the .env file
		if [ -f .env ]; then
			source .env
		fi
		# Temporarily add ./ to PATH and execute the command
		PATH="./:$PATH" bash -c "$*"
		;;
	*)
		bare_script_name="$1" && shift
		# take the content of the given file, prepend "#!/usr/bin/env bash" and "export PATH=\"$PATH:.\"" and then execute
		(printf '#!/usr/bin/env bash\nexport PATH="%s:.\"\n' "$PATH"; cat .scripts/"$bare_script_name".bare) | bash -s -- "$@"
		;;
esac