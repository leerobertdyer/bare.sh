#!/usr/bin/env bash
# Call a script from the b/ directory.

source "$(dirname "${BASH_SOURCE[0]}")/lib/init"

declare -A scopes
for scope in $(ls b/*); do
    if [[ -f $scope ]]; then
        scope_name=$(basename $scope)
        scope_desc=$(sed -n '2p' $scope | cut -c 3-)
        scopes[$scope_name]=$scope_desc
    fi
done

[[ -z "$1" ]] && {
	args=""
	for scope in $(echo "${!scopes[@]}" | tr ' ' '\n' | sort); do
		args+="$scope \"${scopes[$scope]}\" "
	done
	eval "b/usage -w 8 -t \"scope\" "bare" $args"
	exit 0
}

# make sure the first argument is a valid scope.
[[ -z "${scopes[$1]}" ]] && b/error invalid_scope "Only executables in the b/ directory are allowed."

command="$1" && shift && "b/$command" "$@" # vroom vroom