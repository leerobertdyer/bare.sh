#!/usr/bin/env bash

# Change directory to the current script's directory
cd "$(dirname "$0")"
touch ~/.bashrc

# Source the .env file
[[ -f .etc/barerc ]] && source .etc/barerc

# Temporarily add ./ to PATH
PATH="./:$PATH"

mkdir -p ".var/www"

# Use rsync to sync files from .lib/www to .var/www without overwriting new files in .var/www
rsync -av --ignore-existing ".lib/www/" ".var/www/" >> /dev/null

# Check if the -I flag is provided for interactive mode
if [[ "$1" == "-I" ]]; then
  shift
  echo ""
  echo "🧙 Entering bare interactive mode. Type 'exit' to leave."
  echo ""
  echo "- - - - -"
  echo ""
  # Start an interactive bash shell with the current environment
  exec bash --rcfile <(echo "PS1='🐻 bare > '; source ~/.bashrc; PATH=\"$PATH\"")
else
  # Delegate the rest
  script_name="$1" && shift && ./"$script_name" "$@"
fi