#!/usr/bin/env bash

OS=$(uname)



# Ubuntu 22.04

[[ "$OS" == "Linux" ]] && {
	# list of packages to install
	packages=("curl" "npm" "tiv" "glow" "snapd" "jq" "lxd" "git" "nginx" "ffmpeg" "csvkit")

	for package in "${packages[@]}"; do
		if ! [ -x "$(command -v "$package")" ]; then
			echo "$package is not installed. Do you want to install it? (y/n)"
			read -r answer
			if [ "$answer" = "y" ]; then
				sudo apt update
				sudo apt install -y "$package"
			fi
		fi
	done

	# special cases
	if ! [ -x "$(command -v marp)" ]; then
		echo "Marp is not installed. Do you want to install it? (y/n)"
		read -r answer
		if [ "$answer" = "y" ]; then
			sudo npm install -g @marp-team/marp-cli
		fi
	fi

	if ! [ -x "$(command -v nb)" ]; then
		echo "nb is not installed. Do you want to install it? (y/n)"
		read -r answer
		if [ "$answer" = "y" ]; then
			sudo curl -L https://raw.github.com/xwmx/nb/master/nb -o /usr/local/bin/nb && sudo chmod +x /usr/local/bin/nb
		fi
	fi
}





# macOS

[[ "$OS" == "Darwin" ]] && {
	# list of packages to install
	packages=("curl" "npm" "tiv" "glow" "jq" "git" "nginx" "ffmpeg" "csvkit")

	for package in "${packages[@]}"; do
		if ! [ -x "$(command -v "$package")" ]; then
			echo "$package is not installed. Do you want to install it? (y/n)"
			read -r answer
			if [ "$answer" = "y" ]; then
				brew install "$package"
			fi
		fi
	done

	# special cases
	if ! [ -x "$(command -v marp)" ]; then
		echo "Marp is not installed. Do you want to install it? (y/n)"
		read -r answer
		if [ "$answer" = "y" ]; then
			brew install marp-cli
		fi
	fi
}

# check if global git user and email is set
if [ -z "$(git config --global user.name)" ]; then
	printf "\n- - - ðŸŒ¿ Git Configuration ðŸŒ¿ - - -\n"
	printf "\nPlease enter your name for Git: " && read -r git_name
	git config --global user.name "$git_name"
	printf "\nPlease enter your email for Git: " && read -r git_email
	git config --global user.email "$git_email"
	# update the global git user and email in lib/.env
	sed -i "s/GIT_USER=.*/GIT_USER=$git_name/g" lib/.env
	sed -i "s/GIT_EMAIL=.*/GIT_EMAIL=$git_email/g" lib/.env
	source lib/.env
fi