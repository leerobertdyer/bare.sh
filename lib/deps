#!/usr/bin/env bash

OS=$(uname)

# check that curl is installed
if ! [ -x "$(command -v curl)" ]; then
    if [ "$OS" = "Linux" ]; then
        sudo apt update
        sudo apt install -y curl
    elif [ "$OS" = "Darwin" ]; then
        brew install curl
    fi
fi

# check that glow is installed
if ! [ -x "$(command -v glow)" ]; then
	if [ "$OS" = "Linux" ]; then
		sudo snap install glow
	elif [ "$OS" = "Darwin" ]; then
		brew install glow
	fi
fi

# check that snap is installed
if ! [ -x "$(command -v snap)" ]; then
    if [ "$OS" = "Linux" ]; then
        sudo apt update
        sudo apt install snapd -y
    fi
fi

# check that nb is installed
if ! [ -x "$(command -v nb)" ]; then
    sudo curl -L https://raw.github.com/xwmx/nb/master/nb -o /usr/local/bin/nb && sudo chmod +x /usr/local/bin/nb
fi

# check that jq is installed
if ! [ -x "$(command -v jq)" ]; then
    if [ "$OS" = "Linux" ]; then
        sudo apt install -y jq
    elif [ "$OS" = "Darwin" ]; then
        brew install jq
    fi
fi

# check that lxc is installed
if ! [ -x "$(command -v lxc)" ]; then
    if [ "$OS" = "Linux" ]; then
        sudo apt update
        sudo apt install -y lxd
    fi
fi

# check that git is installed
if ! [ -x "$(command -v git)" ]; then
    if [ "$OS" = "Linux" ]; then
        sudo apt update
        sudo apt install -y git
    elif [ "$OS" = "Darwin" ]; then
        brew install git
    fi
fi

# check if global git user and email is set
if [ -z "$(git config --global user.name)" ]; then
    printf "\n- - - ðŸŒ¿ Git Configuration ðŸŒ¿ - - -\n"
    printf "\nPlease enter your name for Git: " && read git_name
    git config --global user.name "$git_name"
    printf "\nPlease enter your email for Git: " && read git_email
    git config --global user.email "$git_email"
    # update the global git user and email in lib/.env
    sed -i "s/GIT_USER=.*/GIT_USER=$git_name/g" lib/.env
    sed -i "s/GIT_EMAIL=.*/GIT_EMAIL=$git_email/g" lib/.env
    source lib/.env
fi

# check if Nginx is installed (and install it if it's not)
if ! [ -x "$(command -v nginx)" ]; then
    if [ "$OS" = "Linux" ]; then
        sudo apt install -y nginx
        sudo systemctl enable nginx
        sudo systemctl start nginx
    elif [ "$OS" = "Darwin" ]; then
        brew install nginx
        sudo brew services start nginx
    fi
fi

# check if SQLPage is installed (and install it if it's not)
if ! [ -x "$(command -v sqlpage)" ]; then
    if [ "$OS" = "Linux" ]; then
        sudo curl -s -L -O https://github.com/lovasoa/SQLpage/releases/download/v0.18.3/sqlpage-linux.tgz
        sudo tar -xzf sqlpage-linux.tgz && sudo rm sqlpage-linux.tgz
        sudo mv sqlpage.bin /usr/bin/sqlpage
        sudo chmod 750 /usr/bin/sqlpage
    elif [ "$OS" = "Darwin" ]; then
        brew install sqlpage
    fi
fi

# check that ffmpeg is installed
if ! [ -x "$(command -v ffmpeg)" ]; then
    if [ "$OS" = "Linux" ]; then
        sudo apt install -y ffmpeg
    elif [ "$OS" = "Darwin" ]; then
        brew install ffmpeg
    fi
fi

# check for csvkit
if ! [ -x "$(command -v csvlook)" ]; then
    if [ "$OS" = "Linux" ]; then
        sudo apt install -y csvkit
    elif [ "$OS" = "Darwin" ]; then
        brew install csvkit
    fi
fi